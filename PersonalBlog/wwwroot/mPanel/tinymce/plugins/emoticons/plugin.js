!function(){"use strict";var n,t,e,r,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=function(){return(i=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},u=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}},a=Object.prototype.hasOwnProperty,c=(n=function(n,t){return t},function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)a.call(i,u)&&(r[u]=n(r[u],i[u]))}return r}),l=function(n){return function(){return n}},s=l(!1),f=l(!0),m=function(){return g},g=(t=function(n){return n.isNone()},{fold:function(n,t){return n()},is:s,isSome:s,isNone:f,getOr:r=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:l(null),getOrUndefined:l(void 0),or:r,orThunk:e,map:m,each:function(){},bind:m,exists:s,forall:f,filter:m,equals:t,equals_:t,toArray:function(){return[]},toString:l("none()")}),d=function(n){var t=l(n),e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:f,isNone:s,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return d(t(n))},each:function(t){t(n)},bind:r,exists:r,forall:r,filter:function(t){return t(n)?o:g},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(s,(function(t){return e(n,t)}))}};return o},v={some:d,none:m,from:function(n){return null==n?g:d(n)}},h=Object.keys,y=Object.hasOwnProperty,p=function(n,t){for(var e=h(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i)}},b=function(n,t){return-1!==n.indexOf(t)},w=tinymce.util.Tools.resolve("tinymce.Resource"),O=tinymce.util.Tools.resolve("tinymce.util.Delay"),C=tinymce.util.Tools.resolve("tinymce.util.Promise"),j="All",k={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},A=function(n,t){return e=n,r=t,y.call(e,r)?n[t]:t;var e,r},_=function(n){var t,e=function(n){return n.getParam("emoticons_append",{},"object")}(n);return t=function(n){return i({keywords:[],category:"user"},n)},function(n,t){var e={};return p(n,(function(n,r){var o=t(n,r);e[o.k]=o.v})),e}(e,(function(n,e){return{k:e,v:t(n)}}))},T=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r},P=function(n,t){return b(n.title.toLowerCase(),t)||function(n,e){for(var r=0,o=n.length;r<o;r++)if(i=n[r],b(i.toLowerCase(),t))return!0;var i;return!1}(n.keywords)},x=function(n,t,e){for(var r=[],o=t.toLowerCase(),i=e.fold((function(){return s}),(function(n){return function(t){return t>=n}})),u=0;u<n.length&&(0!==t.length&&!P(n[u],o)||(r.push({value:n[u].char,text:n[u].title,icon:n[u].char}),!i(r.length)));u++);return r},D="pattern";o.add("emoticons",(function(n,t){var e=function(n,t){var e=function(n){return n.getParam("emoticons_database","emojis","string")}(n);return n.getParam("emoticons_database_url",t+"/js/"+e+n.suffix+".js","string")}(n,t),r=function(n){return n.getParam("emoticons_database_id","tinymce.plugins.emoticons","string")}(n),o=function(n,t,e){var r=u(v.none()),o=u(v.none()),i=function(n){return n.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string")}(n),a=function(n){return e="<img",(t=n.char).length>=e.length&&t.substr(0,0+e.length)===e?n.char.replace(/src="([^"]+)"/,(function(n,t){return'src="'+i+t+'"'})):n.char;var t,e};n.on("init",(function(){w.load(e,t).then((function(t){var e=_(n);!function(n){var t={},e=[];p(n,(function(n,r){var o={title:r,keywords:n.keywords,char:a(n),category:A(k,n.category)},i=void 0!==t[o.category]?t[o.category]:[];t[o.category]=i.concat([o]),e.push(o)})),r.set(v.some(t)),o.set(v.some(e))}(c(t,e))}),(function(n){console.log("Failed to load emoticons: "+n),r.set(v.some({})),o.set(v.some([]))}))}));var l=function(){return o.get().getOr([])},s=function(){return r.get().isSome()&&o.get().isSome()};return{listCategories:function(){return[j].concat(h(r.get().getOr({})))},hasLoaded:s,waitForLoad:function(){return s()?C.resolve(!0):new C((function(n,e){var r=15,o=O.setInterval((function(){s()?(O.clearInterval(o),n(!0)):--r<0&&(console.log("Could not load emojis from url: "+t),O.clearInterval(o),e(!1))}),100)}))},listAll:l,listCategory:function(n){return n===j?l():r.get().bind((function(t){return v.from(t[n])})).getOr([])}}}(n,e,r);!function(n,t){var e=function(){return function(n,t){var e,r,o={pattern:"",results:x(t.listAll(),"",v.some(300))},i=u(j),a=(e=function(n){!function(n){var e=n.getData(),r=i.get(),o=t.listCategory(r),u=x(o,e.pattern,r===j?v.some(300):v.none());n.setData({results:u})}(n)},r=null,{cancel:function(){null!==r&&(clearTimeout(r),r=null)},throttle:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];null!==r&&clearTimeout(r),r=setTimeout((function(){e.apply(null,n),r=null}),200)}}),c={label:"Search",type:"input",name:D},l={type:"collection",name:"results"},s=function(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:T(t.listCategories(),(function(n){return{title:n,name:n,items:[c,l]}}))},initialData:o,onTabChange:function(n,t){i.set(t.newTabName),a.throttle(n)},onChange:a.throttle,onAction:function(t,e){"results"===e.name&&(function(n,t){n.insertContent(t)}(n,e.value),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},f=n.windowManager.open(s());f.focus(D),t.hasLoaded()||(f.block("Loading emoticons..."),t.waitForLoad().then((function(){f.redial(s()),a.throttle(f),f.focus(D),f.unblock()})).catch((function(n){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(D),f.unblock()})))}(n,t)};n.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:e}),n.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:e})}(n,o),function(n,t){n.ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return t.waitForLoad().then((function(){var r=t.listAll();return x(r,n,v.some(e))}))},onAction:function(t,e,r){n.selection.setRng(e),n.insertContent(r),t.hide()}})}(n,o),function(n){n.on("PreInit",(function(){n.parser.addAttributeFilter("data-emoticon",(function(n){!function(n,t){for(var e=0,r=n.length;e<r;e++)(o=n[e]).attr("data-mce-resize","false"),o.attr("data-mce-placeholder","1");var o}(n)}))}))}(n)}))}();
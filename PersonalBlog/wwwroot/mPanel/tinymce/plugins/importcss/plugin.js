!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),n=tinymce.util.Tools.resolve("tinymce.EditorManager"),r=tinymce.util.Tools.resolve("tinymce.Env"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),o=function(t){return t.getParam("importcss_selector_converter")},c=function(t){return t.getParam("importcss_append")},u=("array",function(t){return n=typeof(e=t),"array"===(null===e?"null":"object"===n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n);var e,n}),s=Array.prototype.push,a=function(t){return"string"==typeof t?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t},l=function(t,e,o){var c=[],u={};function s(e,u){var a,l,f,m=e.href;if(l=m,f=r.cacheSuffix,"string"==typeof l&&(l=l.replace("?"+f,"").replace("&"+f,"")),(m=l)&&o(m,u)&&!function(t,e){var r=function(t){var e=t.getParam("skin");return!1!==e&&(e||"oxide")}(t);if(r){var i=function(t){return t.getParam("skin_url")}(t),o=i?t.documentBaseURI.toAbsolute(i):n.baseURL+"/skins/ui/"+r,c=n.baseURL+"/skins/content/";return e===o+"/content"+(t.inline?".inline":"")+".min.css"||-1!==e.indexOf(c)}return!1}(t,m)){i.each(e.imports,(function(t){s(t,!0)}));try{a=e.cssRules||e.rules}catch(t){}i.each(a,(function(t){t.styleSheet?s(t.styleSheet,!0):t.selectorText&&i.each(t.selectorText.split(","),(function(t){c.push(i.trim(t))}))}))}}i.each(t.contentCSS,(function(t){u[t]=!0})),o||(o=function(t,e){return e||u[t]});try{i.each(e.styleSheets,(function(t){s(t)}))}catch(t){}return c},f=function(t,e){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(r){var o=r[1],c=r[2].substr(1).split(".").join(" "),u=i.makeMap("a,img");return r[1]?(n={title:e},t.schema.getTextBlockElements()[o]?n.block=o:t.schema.getBlockElements()[o]||u[o.toLowerCase()]?n.selector=o:n.inline=o):r[2]&&(n={inline:"span",title:e.substr(1),classes:c}),!1!==function(t){return t.getParam("importcss_merge_classes")}(t)?n.classes=c:n.attributes={class:c},n}},m=function(t,e){return null===e||!1!==function(t){return t.getParam("importcss_exclusive")}(t)},p=function(t){t.on("init",(function(n){var r=function(){var t=[],e=[],n={};return{addItemToGroup:function(t,r){n[t]?n[t].push(r):(e.push(t),n[t]=[r])},addItem:function(e){t.push(e)},toFormats:function(){return(r=e,i=function(t){var e=n[t];return 0===e.length?[]:[{title:t,items:e}]},function(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!u(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);s.apply(e,t[n])}return e}(function(t,e){for(var n=t.length,r=new Array(n),i=0;i<n;i++){var o=t[i];r[i]=e(o,i)}return r}(r,i))).concat(t);var r,i}}}(),p={},v=a(function(t){return t.getParam("importcss_selector_filter")}(t)),y=function(t){return i.map(t,(function(t){return i.extend({},t,{original:t,selectors:{},filter:a(t.filter),item:{text:t.title,menu:[]}})}))}(function(t){return t.getParam("importcss_groups")}(t)),g=function(n,r){if(function(t,e,n,r){return!(m(t,n)?e in r:e in n.selectors)}(t,n,r,p)){!function(t,e,n,r){m(t,n)?r[e]=!0:n.selectors[e]=!0}(t,n,r,p);var c=function(t,e,n,r){return(r&&r.selector_converter?r.selector_converter:o(t)?o(t):function(){return f(t,n)}).call(e,n,r)}(t,t.plugins.importcss,n,r);if(c){var u=c.name||e.DOM.uniqueId();return t.formatter.register(u,c),i.extend({},{title:c.title,format:u})}}return null};i.each(l(t,t.getDoc(),a(function(t){return t.getParam("importcss_file_filter")}(t))),(function(t){if(-1===t.indexOf(".mce-")&&(!v||v(t))){var e=function(t,e){return i.grep(t,(function(t){return!t.filter||t.filter(e)}))}(y,t);if(e.length>0)i.each(e,(function(e){var n=g(t,e);n&&r.addItemToGroup(e.title,n)}));else{var n=g(t,null);n&&r.addItem(n)}}}));var h=r.toFormats();t.fire("addStyleModifications",{items:h,replace:!c(t)})}))};t.add("importcss",(function(t){return p(t),function(t){return{convertSelectorToFormat:function(e){return f(t,e)}}}(t)}))}();
!function(){"use strict";var t,n,e,r,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.util.VK"),u=function(t){return function(n){return r=typeof(e=n),(null===e?"null":"object"==r&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":r)===t;var e,r}},a=function(t){return function(n){return typeof n===t}},l=u("string"),c=u("array"),f=function(n){return t===n},s=a("boolean"),m=a("function"),g=function(t){var n=t.getParam("link_assume_external_targets",!1);return s(n)&&n?1:!l(n)||"http"!==n&&"https"!==n?0:n},d=function(t){return t.getParam("default_link_target")},h=function(t){return t.getParam("target_list",!0)},p=function(t){return t.getParam("rel_list",[],"array")},v=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},y=function(){},k=function(t){return function(){return t}},x=k(!1),b=k(!(t=null)),O=function(){return w},w=(n=function(t){return t.isNone()},{fold:function(t,n){return t()},is:x,isSome:x,isNone:b,getOr:r=function(t){return t},getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:k(null),getOrUndefined:k(void 0),or:r,orThunk:e,map:O,each:y,bind:O,exists:x,forall:b,filter:O,equals:n,equals_:n,toArray:function(){return[]},toString:k("none()")}),C=function(t){var n=k(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:b,isNone:x,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return C(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:w},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(x,(function(n){return e(t,n)}))}};return o},N={some:C,none:O,from:function(t){return null==t?w:C(t)}},A=Array.prototype.indexOf,P=Array.prototype.push,T=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!c(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);P.apply(n,t[e])}return n},S=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return N.none()},_=function(t,n){return t?N.some(n):N.none()},R=tinymce.util.Tools.resolve("tinymce.util.Tools"),D=function(t){return l(t.value)?t.value:""},L=function(t,n){var e=[];return R.each(t,(function(t){var r,o,i,u=l((r=t).text)?r.text:l(r.title)?r.title:"";void 0!==t.menu?(o=L(t.menu,n),e.push({text:u,items:o})):(i=n(t),e.push({text:u,value:i}))})),e},E=function(t){return void 0===t&&(t=D),function(n){return N.from(n).map((function(n){return L(n,t)}))}},M=function(t){return E(D)(t)},B=E,q=function(t,n){return function(e){return{name:t,type:"listbox",label:n,items:e}}},I=D,K=function(){return(K=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},j=Object.keys,U=Object.hasOwnProperty,F=function(t,n){return U.call(t,n)},V=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),H=function(t){return t&&"a"===t.nodeName.toLowerCase()},z=function(t){return H(t)&&!!W(t)},G=function(t,n){if(t.collapsed)return[];for(var e=t.cloneContents(),r=new V(e.firstChild,e),o=[],i=e.firstChild;n(i)&&o.push(i),i=r.next(););return o},J=function(t){return/^\w+:/i.test(t)},W=function(t){return t.getAttribute("data-mce-href")||t.getAttribute("href")},X=function(t,n){var e,r,o=["noopener"],i=t?t.split(/\s+/):[],u=function(t){return t.filter((function(t){return-1===R.inArray(o,t)}))},a=n?0<(e=u(e=i)).length?e.concat(o):o:u(i);return 0<a.length?(r=a,R.trim(r.sort().join(" "))):""},$=function(t,n){return n=n||t.selection.getNode(),tt(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},Q=function(t,n){return(n?n.innerText||n.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},Y=function(t){return 0<R.grep(t,z).length},Z=function(t){var n=t.schema.getTextInlineElements();return 0===G(t.selection.getRng(),(function(t){return 1===t.nodeType&&!H(t)&&!F(n,t.nodeName.toLowerCase())})).length},tt=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},nt=function(t,n){var e,r,o,i=K({},n);return 0<p(t).length||!1!==v(t)||(e=X(i.rel,"_blank"===i.target),i.rel=e||null),N.from(i.target).isNone()&&!1===h(t)&&(i.target=d(t)),i.href=(r=i.href,"http"!==(o=g(t))&&"https"!==o||J(r)?r:o+"://"+r),i},et=function(t,n,e){var r,o,i,u,a,l,c;t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,(o=(r=e).class,i=r.href,u=r.rel,a=r.target,l=r.text,c=r.title,function(t,n){var e,r={};return function(t,n,e,r){!function(t,n){for(var e=j(t),r=0,o=e.length;r<o;r++){var i=e[r];n(t[i],i)}}(t,(function(t,o){(n(t,o)?e:r)(t,o)}))}(t,n,(e=r,function(t,n){e[n]=t}),y),r}({class:o.getOrNull(),href:i,rel:u.getOrNull(),target:a.getOrNull(),text:l.getOrNull(),title:c.getOrNull()},(function(t,n){return!1===f(t)})))):function(t,n,e){var r=t.selection.getNode(),o=$(t,r),i=nt(t,function(t){return n=["title","rel","class","target"],e=function(n,e){return t[e].each((function(t){n[e]=0<t.length?t:null})),n},r={href:t.href},function(t,n){for(var e=0,r=t.length;e<r;e++)n(t[e])}(n,(function(t){r=e(r,t)})),r;var n,e,r}(e));t.undoManager.transact((function(){var u,a,l,c,f,s,m,g;e.href===n.href&&n.attach(),o?(t.focus(),f=t,s=o,m=e.text,g=i,m.each((function(t){s.hasOwnProperty("innerText")?s.innerText=t:s.textContent=t})),f.dom.setAttribs(s,g),f.selection.select(s)):(u=t,a=r,l=e.text,c=i,tt(a)?it(u,a,c):l.fold((function(){u.execCommand("mceInsertLink",!1,c)}),(function(t){u.insertContent(u.dom.createHTML("a",c,u.dom.encode(t)))})))}))}(t,n,e)},rt=function(t){t.hasPlugin("rtc",!0)?t.execCommand("unlink"):function(t){t.undoManager.transact((function(){var n,e,r,o,i,u,a,l=t.selection.getNode();tt(l)?ot(t,l):(e=(n=t).dom,o=(r=n.selection).getBookmark(),i=r.getRng().cloneRange(),u=e.getParent(i.startContainer,"a[href]",n.getBody()),a=e.getParent(i.endContainer,"a[href]",n.getBody()),u&&i.setStartBefore(u),a&&i.setEndAfter(a),r.setRng(i),n.execCommand("unlink"),r.moveToBookmark(o)),t.focus()}))}(t)},ot=function(t,n){var e,r=t.dom.select("img",n)[0];!r||(e=t.dom.getParents(r,"a[href]",n)[0])&&(e.parentNode.insertBefore(r,e),t.dom.remove(e))},it=function(t,n,e){var r,o=t.dom.select("img",n)[0];o&&(r=t.dom.create("a",e),o.parentNode.insertBefore(r,o),r.appendChild(o))},ut=function(t,n){return S(n,(function(n){return function(t){return F(n=t,e="items")&&void 0!==n[e]&&null!==n[e];var n,e}(n)?ut(t,n.items):_(n.value===t,n)}))},at=function(t,n){var e={text:t.text,title:t.title};return{onChange:function(t,r){var o=r.name;return"url"===o?function(t){var n,r,o=(n=t.url,_(e.text.length<=0,N.from(n.meta.text).getOr(n.value))),i=(r=t.url,_(e.title.length<=0,N.from(r.meta.title).getOr("")));return o.isSome()||i.isSome()?N.some(K(K({},o.map((function(t){return{text:t}})).getOr({})),i.map((function(t){return{title:t}})).getOr({}))):N.none()}(t()):function(t,n){return e=["anchor","link"],r=n,-1<A.call(e,r);var e,r}(0,o)?function(t,r){var o,i,u=(o=n,("link"===(i=r.name)?o.link:"anchor"===i?o.anchor:N.none()).getOr([]));return function(t,n,e,r){var o=r[n],i=0<t.length;return void 0!==o?ut(o,e).map((function(n){return{url:{value:n.value,meta:{text:i?t:n.text,attach:y}},text:i?t:n.text}})):N.none()}(e.text,r.name,u,t)}(t(),r):(("text"===o||"title"===o)&&(e[o]=t()[o]),N.none())}}},lt=tinymce.util.Tools.resolve("tinymce.util.Delay"),ct=tinymce.util.Tools.resolve("tinymce.util.Promise"),ft=function(t){var n=t.href;return 0<n.indexOf("@")&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:")?N.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return K(K({},t),{href:"mailto:"+n})}}):N.none()},st=function(t,n){return S([ft,(e=g(t),r=t.getParam("link_default_protocol","http","string"),function(t){var n=t.href;return 1===e&&!J(n)||0===e&&/^\s*www(\.|\d\.)/i.test(n)?N.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(t){return K(K({},t),{href:r+"://"+n})}}):N.none()})],(function(t){return t(n)})).fold((function(){return ct.resolve(n)}),(function(e){return new ct((function(r){var o,i,u,a;o=t,i=e.message,u=function(t){r(t?e.preprocess(n):n)},a=o.selection.getRng(),lt.setEditorTimeout(o,(function(){o.windowManager.confirm(i,(function(t){o.selection.setRng(a),u(t)}))}))}))}));var e,r},mt=function(t){var n=function(t,n){return T(function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r}(t,(function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]})))}(t.dom.select("a:not([href])"));return 0<n.length?N.some([{text:"None",value:""}].concat(n)):N.none()},gt=function(t){var n=t.getParam("link_class_list",[],"array");return 0<n.length?M(n):N.none()},dt=tinymce.util.Tools.resolve("tinymce.util.XHR"),ht=function(t,n){var e=p(t);if(0<e.length){var r=n.is("_blank");return(!1===v(t)?B((function(t){return X(I(t),r)})):M)(e)}return N.none()},pt=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],vt=function(t){var n=h(t);return c(n)?M(n).orThunk((function(){return N.some(pt)})):!1===n?N.none():N.some(pt)},yt=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&0<r.length?N.some(r):N.none()},kt=function(t,n){return t.dom.getParent(n,"a[href]")},xt=function(t){return kt(t,t.selection.getStart())},bt=function(t,n){var e,r;n&&(e=W(n),/^#/.test(e)?(r=t.$(e)).length&&t.selection.scrollIntoView(r[0],!0):function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var e,r,o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e=n,r=o,document.body.appendChild(e),e.dispatchEvent(r),document.body.removeChild(e)}(n.href))},Ot=function(t){return function(){!function(t){var n,e;(e=$(n=t),function(t,n){return function(t){var n=function(n){return t.convertURL(n.value||n.url,"href")},e=t.getParam("link_list");return new ct((function(t){l(e)?dt.send({url:e,success:function(n){return t(function(t){try{return N.some(JSON.parse(t))}catch(t){return N.none()}}(n))},error:function(n){return t(N.none())}}):m(e)?e((function(n){return t(N.some(n))})):t(N.from(e))})).then((function(t){return t.bind(B(n)).map((function(t){return 0<t.length?[{text:"None",value:""}].concat(t):t}))}))}(t).then((function(e){var r,o,i,u,a,l,c,f,s=(o=n,i=(r=t).dom,u=Z(r)?N.some(Q(r.selection,o)):N.none(),a=o?N.some(i.getAttrib(o,"href")):N.none(),l=o?N.from(i.getAttrib(o,"target")):N.none(),c=yt(i,o,"rel"),f=yt(i,o,"class"),{url:a,text:u,title:yt(i,o,"title"),target:l,rel:c,linkClass:f});return{anchor:s,catalogs:{targets:vt(t),rels:ht(t,s.target),classes:gt(t),anchor:mt(t),link:e},optNode:N.from(n),flags:{titleEnabled:t.getParam("link_title",!0,"boolean")}}}))}(n,e)).then((function(n){var e,r,o,i,u,a,l,c,f,s,m,g,h;return i=function(t){var n=t.getData();if(!n.url.value)return rt(e),void t.close();var o=function(t){return N.from(n[t]).filter((function(n){return!r.anchor[t].is(n)}))},i={href:n.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:function(){}};st(e,i).then((function(t){et(e,u,t)})),t.close()},u=e=t,f=(o=r=n).anchor.text.map((function(){return{name:"text",type:"input",label:"Text to display"}})).toArray(),s=o.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],a=N.from(d(u)),m={url:{value:c=(l=o.anchor).url.getOr(""),meta:{original:{value:c}}},text:l.text.getOr(""),title:l.title.getOr(""),anchor:c,link:c,rel:l.rel.getOr(""),target:l.target.or(a).getOr(""),linkClass:l.linkClass.getOr("")},g=o.catalogs,h=at(m,g),{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:T([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],f,s,function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n}([g.anchor.map(q("anchor","Anchors")),g.rels.map(q("rel","Rel")),g.targets.map(q("target","Open link in...")),g.link.map(q("link","Link list")),g.classes.map(q("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:m,onChange:function(t,n){var e=n.name;h.onChange(t.getData,{name:e}).each((function(n){t.setData(n)}))},onSubmit:i}})).then((function(n){t.windowManager.open(n)}))}(t)}},wt=function(t){return function(){bt(t,xt(t))}},Ct=function(t){t.on("click",(function(n){var e=kt(t,n.target);e&&i.metaKeyPressed(n)&&(n.preventDefault(),bt(t,e))})),t.on("keydown",(function(n){var e,r=xt(t);r&&13===n.keyCode&&!0===(e=n).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey&&(n.preventDefault(),bt(t,r))}))},Nt=function(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}},At=function(t){return function(n){return Nt(t,(function(){n.setActive(!t.mode.isReadOnly()&&null!==$(t,t.selection.getNode()))}))}},Pt=function(t){return function(n){var e=function(){return n.setDisabled(null===$(t,t.selection.getNode()))};return e(),Nt(t,e)}},Tt=function(t){return function(n){var e=function(n){return Y(n)||(e=t.selection.getRng(),0<G(e,z).length);var e},r=t.dom.getParents(t.selection.getStart());return n.setDisabled(!e(r)),Nt(t,(function(t){return n.setDisabled(!e(t.parents))}))}};o.add("link",(function(t){var n,e,r,o,i,u,a;(n=t).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:Ot(n),onSetup:At(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:wt(n),onSetup:Pt(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return rt(n)},onSetup:Tt(n)}),(e=t).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:wt(e),onSetup:Pt(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:Ot(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return rt(e)},onSetup:Tt(e)}),(r=t).ui.registry.addContextMenu("link",{update:function(t){return Y(r.dom.getParents(t,"a"))?"link unlink openlink":"link"}}),i=function(t){var n=o.selection.getNode();return t.setDisabled(!$(o,n)),function(){}},(o=t).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:At(o)},label:"Link",predicate:function(t){return!!$(o,t)&&o.getParam("link_context_toolbar",!1,"boolean")},initValue:function(){var t=$(o);return t?W(t):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(t){var n=o.selection.getNode();return t.setActive(!!$(o,n)),At(o)(t)},onAction:function(t){var n,e,r=$(o),i=t.getValue();r?o.undoManager.transact((function(){o.dom.setAttrib(r,"href",i),o.selection.collapse(!1),t.hide()})):(n={href:i,attach:function(){}},e=Z(o)?N.some(Q(o.selection,r)).filter((function(t){return 0<t.length})).or(N.from(i)):N.none(),et(o,n,{href:i,text:e,title:N.none(),rel:N.none(),target:N.none(),class:N.none()}),t.hide())}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:i,onAction:function(t){rt(o),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:i,onAction:function(t){wt(o)(),t.hide()}}]}),Ct(t),(u=t).addCommand("mceLink",(function(){u.getParam("link_quicklink",!1,"boolean")?u.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):Ot(u)()})),(a=t).addShortcut("Meta+K","",(function(){a.execCommand("mceLink")}))}))}();
!function(){"use strict";var n,t,o,e=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(n){return function(){return n}},i=r(!1),u=r(!0),c=function(){return a},a=(n=function(n){return n.isNone()},{fold:function(n,t){return n()},is:i,isSome:i,isNone:u,getOr:o=function(n){return n},getOrThunk:t=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:r(null),getOrUndefined:r(void 0),or:o,orThunk:t,map:c,each:function(){},bind:c,exists:i,forall:u,filter:c,equals:n,equals_:n,toArray:function(){return[]},toString:r("none()")}),s=function(n){return function(t){return typeof t===n}},f=function(n){return o=typeof(t=n),"string"===(null===t?"null":"object"===o&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===o&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":o);var t,o},l=s("boolean"),d=s("number"),m=function(n,t){for(var o=0,e=n.length;o<e;o++)t(n[o],o)},v=Object.keys,g=function(n,t){for(var o=v(n),e=0,r=o.length;e<r;e++){var i=o[e];t(n[i],i)}},h=("undefined"!=typeof window?window:Function("return this;")(),function(n){return n.dom.nodeValue}),p=(3,function(n){return 3===function(n){return n.dom.nodeType}(n)}),y=function(n,t,o){!function(n,t,o){if(!(f(o)||l(o)||d(o)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",o,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,o+"")}(n.dom,t,o)},b=function(n,t){n.dom.removeAttribute(t)},w=function(n,t){var o=function(n,t){var o=n.dom.getAttribute(t);return null===o?void 0:o}(n,t);return void 0===o||""===o?[]:o.split(" ")},k=function(n){return void 0!==n.dom.classList},A=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}},C=A,N={" ":"nbsp","­":"shy"},O=function(n,t){var o="";return g(n,(function(n,t){o+=t})),new RegExp("["+o+"]",t?"g":"")},T=O(N),S=O(N,!0),V=function(n){var t="";return g(n,(function(n){t&&(t+=","),t+="span.mce-"+n})),t}(N),B="mce-nbsp",E=function(n){return'<span data-mce-bogus="1" class="mce-'+N[n]+'">'+n+"</span>"},L=function(n){var t=h(n);return p(n)&&void 0!==t&&T.test(t)},j=function(n,t){var o=[],e=function(n,t){for(var o=n.length,e=new Array(o),r=0;r<o;r++){var i=n[r];e[r]=t(i,r)}return e}(n.dom.childNodes,C);return m(e,(function(n){t(n)&&(o=o.concat([n])),o=o.concat(j(n,t))})),o},x=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},P=function(n,t){var o=j(C(t),L);m(o,(function(t){var o,e,r=t.dom.parentNode;if(x(r))o=C(r),e=B,k(o)?o.dom.classList.add(e):function(n,t){(function(n,t,o){var e=w(n,t).concat([o]);y(n,t,e.join(" "))})(n,"class",t)}(o,e);else{for(var i=n.dom.encode(h(t)).replace(S,E),u=n.dom.create("div",null,i),c=void 0;c=u.lastChild;)n.dom.insertAfter(c,t.dom);n.dom.remove(t.dom)}}))},_=function(n,t){var o=n.dom.select(V,t);m(o,(function(t){var o,e;x(t)?(o=C(t),e=B,k(o)?o.dom.classList.remove(e):function(n,t){(function(n,t,o){var e=function(n,t){for(var e=[],r=0,i=n.length;r<i;r++){var u=n[r];u!==o&&e.push(u)}return e}(w(n,t));e.length>0?y(n,t,e.join(" ")):b(n,t)})(n,"class",t)}(o,e),function(n){0===(k(n)?n.dom.classList:function(n){return w(n,"class")}(n)).length&&b(n,"class")}(o)):n.dom.remove(t,!0)}))},D=function(n){var t=n.getBody(),o=n.selection.getBookmark(),e=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}}(n.selection.getNode(),t);_(n,e=void 0!==e?e:t),P(n,e),n.selection.moveToBookmark(o)},q=function(n,t){!function(n,t){n.fire("VisualChars",{state:t})}(n,t.get());var o=n.getBody();!0===t.get()?P(n,o):_(n,o)},I=tinymce.util.Tools.resolve("tinymce.util.Delay"),M=function(n,t){return function(o){o.setActive(t.get());var e=function(n){return o.setActive(n.state)};return n.on("VisualChars",e),function(){return n.off("VisualChars",e)}}};e.add("visualchars",(function(n){var t=function(n){var t=n;return{get:function(){return t},set:function(n){t=n}}}(function(n){return n.getParam("visualchars_default_state",!1)}(n));return function(n,t){n.addCommand("mceVisualChars",(function(){!function(n,t){t.set(!t.get());var o=n.selection.getBookmark();q(n,t),n.selection.moveToBookmark(o)}(n,t)}))}(n,t),function(n,t){n.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return n.execCommand("mceVisualChars")},onSetup:M(n,t)}),n.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:function(){return n.execCommand("mceVisualChars")},onSetup:M(n,t)})}(n,t),function(n,t){var o=I.debounce((function(){D(n)}),300);(function(n){return!1!==n.getParam("forced_root_block")})(n)&&n.on("keydown",(function(e){!0===t.get()&&(13===e.keyCode?D(n):o())})),n.on("remove",o.stop)}(n,t),function(n,t){n.on("init",(function(){q(n,t)}))}(n,t),function(n){return{isEnabled:function(){return n.get()}}}(t)}))}();